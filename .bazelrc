# ================== Bzlmod ==================
common --enable_bzlmod

# ================== C++ Settings ==================
build --cxxopt=-std=c++20
build --host_cxxopt=-std=c++20

# ================== Platform Configs ==================
# These configs work from any supported host platform:
#   - Linux x86_64
#   - macOS aarch64 (Apple Silicon)

# Build for Linux x86_64
# Use: bazel build --config=linux-x86_64 //...
build:linux-x86_64 --platforms=@toolchains_llvm//platforms:linux-x86_64

# Build for Linux aarch64 (ARM64)
# Use: bazel build --config=linux-aarch64 //...
build:linux-aarch64 --platforms=@toolchains_llvm//platforms:linux-aarch64

# Build for macOS aarch64 (Apple Silicon) - native builds on M1/M2/M3
# Use: bazel build --config=macos-aarch64 //...
build:macos-aarch64 --platforms=@toolchains_llvm//platforms:darwin-aarch64

# ================== Hermeticity ==================
# Prevent leaking host environment into builds
build --incompatible_strict_action_env

# ================== Performance ==================
build --jobs=auto

# ================== Error Output ==================
# Show test errors immediately
test --test_output=errors

# ================== Linting ==================
# Lint configuration (warnings only, does not fail build)
# Usage: bazel build --config=lint //...
build:lint --aspects=//bazel/lint:linters.bzl%clang_tidy
build:lint --aspects=//bazel/lint:linters.bzl%ruff
build:lint --output_groups=+rules_lint_report
build:lint --keep_going

# Lint configuration for CI (fail on any violation)
# Usage: bazel build --config=lint-strict //...
build:lint-strict --aspects=//bazel/lint:linters.bzl%clang_tidy
build:lint-strict --aspects=//bazel/lint:linters.bzl%ruff
build:lint-strict --output_groups=+rules_lint_report
build:lint-strict --@aspect_rules_lint//lint:fail_on_violation
build:lint-strict --keep_going
